<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>çœŒåºæ‰€åœ¨åœ°ãƒã‚¹ã‚¿ãƒ¼</title>

<style>
body{
margin:0;
font-family:-apple-system,sans-serif;
background:linear-gradient(135deg,#4facfe,#00f2fe);
display:flex;
justify-content:center;
align-items:center;
height:100vh;
user-select:none;
}

.card{
background:white;
width:95%;
max-width:420px;
border-radius:20px;
padding:20px;
text-align:center;
box-shadow:0 10px 30px rgba(0,0,0,0.2);
}

button{
width:100%;
padding:12px;
margin:6px 0;
font-size:18px;
border:none;
border-radius:12px;
background:#4facfe;
color:white;
touch-action:manipulation;
}

button.secondary{background:#888;}

input{
width:100%;
padding:10px;
font-size:18px;
border-radius:10px;
border:1px solid #ccc;
margin-top:8px;
}

img{
width:85%;
max-width:260px;
margin:10px 0;
}

.hidden{display:none;}

.correct{
color:#00aa00;
font-size:22px;
}

.wrong{
color:#cc0000;
font-size:22px;
}

#nextBtn{
background:linear-gradient(45deg,#ff9800,#ff5722);
}

</style>
</head>

<body>

<div class="card" id="menu">
<h2>çœŒåºæ‰€åœ¨åœ°ãƒã‚¹ã‚¿ãƒ¼</h2>

<div id="playTime">ä»Šæ—¥ã®ãƒ—ãƒ¬ã‚¤æ™‚é–“ï¼š0æ™‚é–“0åˆ†0ç§’</div>
<div id="bestDisplay"></div>

<button onclick="startGame(1)">Lv1 æ±æ—¥æœ¬</button>
<button onclick="startGame(2)">Lv2 è¥¿æ—¥æœ¬</button>
<button onclick="startGame(3)">Lv3 å…¨å›½</button>
<button onclick="startGame(4)">Lv4 æ±æ—¥æœ¬ï¼ˆç”»åƒã®ã¿ï¼‰</button>
<button onclick="startGame(5)">Lv5 è¥¿æ—¥æœ¬ï¼ˆç”»åƒã®ã¿ï¼‰</button>
<button onclick="startGame(6)">LvMAX å…¨å›½ï¼ˆçœŒåï¼‹çœŒåºæ‰€åœ¨åœ°ï¼‰</button>
</div>

<div class="card hidden" id="game">

<h2 id="prefName"></h2>
<img id="prefImage">

<div id="result"></div>

<input id="capitalAnswer" placeholder="çœŒåºæ‰€åœ¨åœ°ã‚’å…¥åŠ›">
<input id="prefAnswer" class="hidden" placeholder="çœŒåã‚’å…¥åŠ›">

<button onclick="checkAnswer()">ç­”ãˆã‚‹</button>
<button id="nextBtn" class="hidden" onclick="nextQuestion()">æ¬¡ã®å•é¡Œ</button>

<div style="display:flex;justify-content:space-between;margin-top:10px;">
<span>æ­£è§£ï¼š<span id="score">0</span></span>
<span>æ®‹ã‚Šï¼š<span id="remaining">0</span></span>
</div>

<button class="secondary" onclick="backToMenu()">ãƒ¬ãƒ™ãƒ«é¸æŠã«æˆ»ã‚‹</button>

</div>

<div class="card hidden" id="finish">

<h2>çµæœ</h2>
<h3 id="finalScore"></h3>
<h3 id="rank"></h3>

<button onclick="restartSameLevel()">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button>
<button class="secondary" onclick="backToMenu()">ãƒ¬ãƒ™ãƒ«é¸æŠã¸</button>

</div>

<script>

/* ===== ãƒ‡ãƒ¼ã‚¿ ===== */

const eastJapan=[
{name:"åŒ—æµ·é“",capital:"æœ­å¹Œå¸‚",file:"hokkaido.png"},
{name:"é’æ£®çœŒ",capital:"é’æ£®å¸‚",file:"aomori.png"},
{name:"å²©æ‰‹çœŒ",capital:"ç››å²¡å¸‚",file:"iwate.png"},
{name:"å®®åŸçœŒ",capital:"ä»™å°å¸‚",file:"miyagi.png"},
{name:"ç§‹ç”°çœŒ",capital:"ç§‹ç”°å¸‚",file:"akita.png"},
{name:"å±±å½¢çœŒ",capital:"å±±å½¢å¸‚",file:"yamagata.png"},
{name:"ç¦å³¶çœŒ",capital:"ç¦å³¶å¸‚",file:"fukushima.png"},
{name:"èŒ¨åŸçœŒ",capital:"æ°´æˆ¸å¸‚",file:"ibaraki.png"},
{name:"æ ƒæœ¨çœŒ",capital:"å®‡éƒ½å®®å¸‚",file:"tochigi.png"},
{name:"ç¾¤é¦¬çœŒ",capital:"å‰æ©‹å¸‚",file:"gunma.png"},
{name:"åŸ¼ç‰çœŒ",capital:"ã•ã„ãŸã¾å¸‚",file:"saitama.png"},
{name:"åƒè‘‰çœŒ",capital:"åƒè‘‰å¸‚",file:"chiba.png"},
{name:"æ±äº¬éƒ½",capital:"æ–°å®¿åŒº",file:"tokyo.png"},
{name:"ç¥å¥ˆå·çœŒ",capital:"æ¨ªæµœå¸‚",file:"kanagawa.png"}
];

const westJapan=[
{name:"æ–°æ½ŸçœŒ",capital:"æ–°æ½Ÿå¸‚",file:"niigata.png"},
{name:"å¯Œå±±çœŒ",capital:"å¯Œå±±å¸‚",file:"toyama.png"},
{name:"çŸ³å·çœŒ",capital:"é‡‘æ²¢å¸‚",file:"ishikawa.png"},
{name:"ç¦äº•çœŒ",capital:"ç¦äº•å¸‚",file:"fukui.png"},
{name:"å±±æ¢¨çœŒ",capital:"ç”²åºœå¸‚",file:"yamanashi.png"},
{name:"é•·é‡çœŒ",capital:"é•·é‡å¸‚",file:"nagano.png"},
{name:"å²é˜œçœŒ",capital:"å²é˜œå¸‚",file:"gifu.png"},
{name:"é™å²¡çœŒ",capital:"é™å²¡å¸‚",file:"shizuoka.png"},
{name:"æ„›çŸ¥çœŒ",capital:"åå¤å±‹å¸‚",file:"aichi.png"},
{name:"ä¸‰é‡çœŒ",capital:"æ´¥å¸‚",file:"mie.png"},
{name:"æ»‹è³€çœŒ",capital:"å¤§æ´¥å¸‚",file:"shiga.png"},
{name:"äº¬éƒ½åºœ",capital:"äº¬éƒ½å¸‚",file:"kyoto.png"},
{name:"å¤§é˜ªåºœ",capital:"å¤§é˜ªå¸‚",file:"osaka.png"},
{name:"å…µåº«çœŒ",capital:"ç¥æˆ¸å¸‚",file:"hyogo.png"},
{name:"å¥ˆè‰¯çœŒ",capital:"å¥ˆè‰¯å¸‚",file:"nara.png"},
{name:"å’Œæ­Œå±±çœŒ",capital:"å’Œæ­Œå±±å¸‚",file:"wakayama.png"},
{name:"é³¥å–çœŒ",capital:"é³¥å–å¸‚",file:"tottori.png"},
{name:"å³¶æ ¹çœŒ",capital:"æ¾æ±Ÿå¸‚",file:"shimane.png"},
{name:"å²¡å±±çœŒ",capital:"å²¡å±±å¸‚",file:"okayama.png"},
{name:"åºƒå³¶çœŒ",capital:"åºƒå³¶å¸‚",file:"hiroshima.png"},
{name:"å±±å£çœŒ",capital:"å±±å£å¸‚",file:"yamaguchi.png"},
{name:"å¾³å³¶çœŒ",capital:"å¾³å³¶å¸‚",file:"tokushima.png"},
{name:"é¦™å·çœŒ",capital:"é«˜æ¾å¸‚",file:"kagawa.png"},
{name:"æ„›åª›çœŒ",capital:"æ¾å±±å¸‚",file:"ehime.png"},
{name:"é«˜çŸ¥çœŒ",capital:"é«˜çŸ¥å¸‚",file:"kochi.png"},
{name:"ç¦å²¡çœŒ",capital:"ç¦å²¡å¸‚",file:"fukuoka.png"},
{name:"ä½è³€çœŒ",capital:"ä½è³€å¸‚",file:"saga.png"},
{name:"é•·å´çœŒ",capital:"é•·å´å¸‚",file:"nagasaki.png"},
{name:"ç†Šæœ¬çœŒ",capital:"ç†Šæœ¬å¸‚",file:"kumamoto.png"},
{name:"å¤§åˆ†çœŒ",capital:"å¤§åˆ†å¸‚",file:"oita.png"},
{name:"å®®å´çœŒ",capital:"å®®å´å¸‚",file:"miyazaki.png"},
{name:"é¹¿å…å³¶çœŒ",capital:"é¹¿å…å³¶å¸‚",file:"kagoshima.png"},
{name:"æ²–ç¸„çœŒ",capital:"é‚£è¦‡å¸‚",file:"okinawa.png"}
];

const allJapan=eastJapan.concat(westJapan);

let currentList=[],current,score=0,levelMode=1,combo=0,totalQuestions=0;

let startTime=Date.now();

/* ===== ã‚²ãƒ¼ãƒ åˆ¶å¾¡ ===== */

function startGame(level){

levelMode=level;
score=0;
combo=0;

document.getElementById("menu").classList.add("hidden");
document.getElementById("finish").classList.add("hidden");
document.getElementById("game").classList.remove("hidden");

if(level==1||level==4) currentList=[...eastJapan];
if(level==2||level==5) currentList=[...westJapan];
if(level==3||level==6) currentList=[...allJapan];

totalQuestions=currentList.length;

document.getElementById("prefAnswer").classList.toggle("hidden",level!=6);

nextQuestion();
}

function nextQuestion(){

if(currentList.length===0){finishGame();return;}

document.getElementById("nextBtn").classList.add("hidden");

let index=Math.floor(Math.random()*currentList.length);
current=currentList.splice(index,1)[0];

document.getElementById("prefImage").src=current.file;
document.getElementById("prefName").textContent=(levelMode<=3)?current.name:"";

document.getElementById("capitalAnswer").value="";
document.getElementById("prefAnswer").value="";
document.getElementById("result").textContent="";
document.getElementById("score").textContent=score;
document.getElementById("remaining").textContent=currentList.length;
}

function checkAnswer(){

let cap=document.getElementById("capitalAnswer").value.trim();
let pref=document.getElementById("prefAnswer").value.trim();

let correct=false;

if(levelMode==6){
correct=(cap===current.capital && pref===current.name);
}else{
correct=(cap===current.capital);
}

if(correct){
score++;
combo++;

document.getElementById("result").className="correct";
document.getElementById("result").textContent="æ­£è§£ï¼";

}else{
combo=0;

document.getElementById("result").className="wrong";
document.getElementById("result").textContent=
"ä¸æ­£è§£ æ­£è§£ï¼š"+current.name+" / "+current.capital;
}

setTimeout(()=>{
document.getElementById("nextBtn").classList.remove("hidden");
},300+Math.random()*400);
}

function finishGame(){

document.getElementById("game").classList.add("hidden");
document.getElementById("finish").classList.remove("hidden");

let percent=Math.round((score/totalQuestions)*100);

let medal="ğŸ“š ç·´ç¿’ä¸­";
if(percent===100) medal="ğŸ‘‘ å®Œå…¨ãƒã‚¹ã‚¿ãƒ¼";
else if(percent>=90) medal="ğŸ† å„ªç§€";
else if(percent>=70) medal="â­ è‰¯ã„";
else if(percent>=50) medal="ğŸ˜Š ãŒã‚“ã°ã‚ã†";

document.getElementById("finalScore").textContent=
"ã‚¹ã‚³ã‚¢ï¼š"+score+" / "+totalQuestions+" ("+percent+"%)";

document.getElementById("rank").textContent=medal;

saveBestScore(percent);
displayBest();
}

/* ===== ä¿å­˜ ===== */

function saveBestScore(percent){
let key="best_capital_level_"+levelMode;
let best=localStorage.getItem(key)||0;
if(percent>best){
localStorage.setItem(key,percent);
}
}

function displayBest(){

let text="å„ãƒ¬ãƒ™ãƒ« ãƒ™ã‚¹ãƒˆã‚¹ã‚³ã‚¢\n";

for(let i=1;i<=6;i++){
let best=localStorage.getItem("best_capital_level_"+i);
if(best) text+="Lv"+i+" : "+best+"%\n";
}

document.getElementById("bestDisplay").innerText=text;
}

/* ===== æˆ»ã‚‹ ===== */

function backToMenu(){
document.getElementById("game").classList.add("hidden");
document.getElementById("finish").classList.add("hidden");
document.getElementById("menu").classList.remove("hidden");
displayBest();
}

function restartSameLevel(){
startGame(levelMode);
}

/* ===== ãƒ—ãƒ¬ã‚¤æ™‚é–“ ===== */

setInterval(()=>{
let sec=Math.floor((Date.now()-startTime)/1000);
localStorage.setItem("todayPlayTime",sec);

let h=Math.floor(sec/3600);
let m=Math.floor((sec%3600)/60);
let s=sec%60;

document.getElementById("playTime").textContent=
"ä»Šæ—¥ã®ãƒ—ãƒ¬ã‚¤æ™‚é–“ï¼š"+h+"æ™‚é–“ "+m+"åˆ† "+s+"ç§’";

},1000);

displayBest();

</script>

</body>
</html>