<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>çœŒåºæ‰€åœ¨åœ°ãƒã‚¹ã‚¿ãƒ¼</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4facfe">

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:linear-gradient(135deg,#4facfe,#00f2fe);
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.card{
  background:white;
  width:95%;
  max-width:420px;
  border-radius:20px;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
  padding:20px;
  text-align:center;
}

button{
  width:100%;
  padding:12px;
  margin:6px 0;
  font-size:16px;
  border:none;
  border-radius:10px;
  background:#4facfe;
  color:white;
}

button.secondary{ background:#888; }

input{
  width:100%;
  padding:10px;
  font-size:18px;
  border-radius:10px;
  border:1px solid #ccc;
  margin-top:8px;
}

img{
  width:85%;
  max-width:260px;
  margin:10px 0;
}

.hidden{display:none;}

.info{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  margin-top:8px;
}

#result{
  min-height:28px;
  font-weight:bold;
  margin-bottom:6px;
}

.correct{ color:green; }
.wrong{ color:red; }

.flash-correct{ background:#eaffea; }
.flash-wrong{ background:#ffeaea; }
</style>
</head>

<body>

<div class="card" id="menu">
<h2>çœŒåºæ‰€åœ¨åœ°ãƒã‚¹ã‚¿ãƒ¼</h2>
<div id="bestDisplay"></div>
<button id="btn1" onclick="startGame(1)">Lv1 æ±æ—¥æœ¬</button>
<button id="btn2" onclick="startGame(2)">Lv2 è¥¿æ—¥æœ¬</button>
<button id="btn3" onclick="startGame(3)">Lv3 å…¨å›½</button>
<button id="btn4" onclick="startGame(4)">Lv4 æ±æ—¥æœ¬ï¼ˆç”»åƒã®ã¿ï¼‰</button>
<button id="btn5" onclick="startGame(5)">Lv5 è¥¿æ—¥æœ¬ï¼ˆç”»åƒã®ã¿ï¼‰</button>
<button id="btn6" onclick="startGame(6)">LvMAX å…¨å›½ï¼ˆçœŒåï¼‹çœŒåºæ‰€åœ¨åœ°ï¼‰</button>
</div>

<div class="card hidden" id="game">
<h2 id="prefName"></h2>
<img id="prefImage">
<div id="result"></div>
<input id="capitalAnswer" placeholder="çœŒåºæ‰€åœ¨åœ°ã‚’å…¥åŠ›">
<input id="prefAnswer" class="hidden" placeholder="çœŒåã‚’å…¥åŠ›">
<button onclick="checkAnswer()">ç­”ãˆã‚‹</button>
<div class="info">
<span>æ­£è§£: <span id="score">0</span></span>
<span>æ®‹ã‚Š: <span id="remaining">0</span></span>
</div>
<button class="secondary" onclick="backToMenu()">ãƒ¬ãƒ™ãƒ«é¸æŠã«æˆ»ã‚‹</button>
</div>

<div class="card hidden" id="finish">
<h2>çµæœ</h2>
<h3 id="finalScore"></h3>
<h3 id="rank"></h3>
<button onclick="restartSameLevel()">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button>
<button class="secondary" onclick="backToMenu()">ãƒ¬ãƒ™ãƒ«é¸æŠã¸</button>
</div>

<script>

// ===== ãƒ‡ãƒ¼ã‚¿ï¼ˆ47éƒ½é“åºœçœŒï¼‰ =====
const eastJapan=[
{name:"åŒ—æµ·é“",capital:"æœ­å¹Œå¸‚",file:"hokkaido.png"},
{name:"é’æ£®çœŒ",capital:"é’æ£®å¸‚",file:"aomori.png"},
{name:"å²©æ‰‹çœŒ",capital:"ç››å²¡å¸‚",file:"iwate.png"},
{name:"å®®åŸçœŒ",capital:"ä»™å°å¸‚",file:"miyagi.png"},
{name:"ç§‹ç”°çœŒ",capital:"ç§‹ç”°å¸‚",file:"akita.png"},
{name:"å±±å½¢çœŒ",capital:"å±±å½¢å¸‚",file:"yamagata.png"},
{name:"ç¦å³¶çœŒ",capital:"ç¦å³¶å¸‚",file:"fukushima.png"},
{name:"èŒ¨åŸçœŒ",capital:"æ°´æˆ¸å¸‚",file:"ibaraki.png"},
{name:"æ ƒæœ¨çœŒ",capital:"å®‡éƒ½å®®å¸‚",file:"tochigi.png"},
{name:"ç¾¤é¦¬çœŒ",capital:"å‰æ©‹å¸‚",file:"gunma.png"},
{name:"åŸ¼ç‰çœŒ",capital:"ã•ã„ãŸã¾å¸‚",file:"saitama.png"},
{name:"åƒè‘‰çœŒ",capital:"åƒè‘‰å¸‚",file:"chiba.png"},
{name:"æ±äº¬éƒ½",capital:"æ–°å®¿åŒº",file:"tokyo.png"},
{name:"ç¥å¥ˆå·çœŒ",capital:"æ¨ªæµœå¸‚",file:"kanagawa.png"}];

const westJapan=[
{name:"æ–°æ½ŸçœŒ",capital:"æ–°æ½Ÿå¸‚",file:"niigata.png"},
{name:"å¯Œå±±çœŒ",capital:"å¯Œå±±å¸‚",file:"toyama.png"},
{name:"çŸ³å·çœŒ",capital:"é‡‘æ²¢å¸‚",file:"ishikawa.png"},
{name:"ç¦äº•çœŒ",capital:"ç¦äº•å¸‚",file:"fukui.png"},
{name:"å±±æ¢¨çœŒ",capital:"ç”²åºœå¸‚",file:"yamanashi.png"},
{name:"é•·é‡çœŒ",capital:"é•·é‡å¸‚",file:"nagano.png"},
{name:"å²é˜œçœŒ",capital:"å²é˜œå¸‚",file:"gifu.png"},
{name:"é™å²¡çœŒ",capital:"é™å²¡å¸‚",file:"shizuoka.png"},
{name:"æ„›çŸ¥çœŒ",capital:"åå¤å±‹å¸‚",file:"aichi.png"},
{name:"ä¸‰é‡çœŒ",capital:"æ´¥å¸‚",file:"mie.png"},
{name:"æ»‹è³€çœŒ",capital:"å¤§æ´¥å¸‚",file:"shiga.png"},
{name:"äº¬éƒ½åºœ",capital:"äº¬éƒ½å¸‚",file:"kyoto.png"},
{name:"å¤§é˜ªåºœ",capital:"å¤§é˜ªå¸‚",file:"osaka.png"},
{name:"å…µåº«çœŒ",capital:"ç¥æˆ¸å¸‚",file:"hyogo.png"},
{name:"å¥ˆè‰¯çœŒ",capital:"å¥ˆè‰¯å¸‚",file:"nara.png"},
{name:"å’Œæ­Œå±±çœŒ",capital:"å’Œæ­Œå±±å¸‚",file:"wakayama.png"},
{name:"é³¥å–çœŒ",capital:"é³¥å–å¸‚",file:"tottori.png"},
{name:"å³¶æ ¹çœŒ",capital:"æ¾æ±Ÿå¸‚",file:"shimane.png"},
{name:"å²¡å±±çœŒ",capital:"å²¡å±±å¸‚",file:"okayama.png"},
{name:"åºƒå³¶çœŒ",capital:"åºƒå³¶å¸‚",file:"hiroshima.png"},
{name:"å±±å£çœŒ",capital:"å±±å£å¸‚",file:"yamaguchi.png"},
{name:"å¾³å³¶çœŒ",capital:"å¾³å³¶å¸‚",file:"tokushima.png"},
{name:"é¦™å·çœŒ",capital:"é«˜æ¾å¸‚",file:"kagawa.png"},
{name:"æ„›åª›çœŒ",capital:"æ¾å±±å¸‚",file:"ehime.png"},
{name:"é«˜çŸ¥çœŒ",capital:"é«˜çŸ¥å¸‚",file:"kochi.png"},
{name:"ç¦å²¡çœŒ",capital:"ç¦å²¡å¸‚",file:"fukuoka.png"},
{name:"ä½è³€çœŒ",capital:"ä½è³€å¸‚",file:"saga.png"},
{name:"é•·å´çœŒ",capital:"é•·å´å¸‚",file:"nagasaki.png"},
{name:"ç†Šæœ¬çœŒ",capital:"ç†Šæœ¬å¸‚",file:"kumamoto.png"},
{name:"å¤§åˆ†çœŒ",capital:"å¤§åˆ†å¸‚",file:"oita.png"},
{name:"å®®å´çœŒ",capital:"å®®å´å¸‚",file:"miyazaki.png"},
{name:"é¹¿å…å³¶çœŒ",capital:"é¹¿å…å³¶å¸‚",file:"kagoshima.png"},
{name:"æ²–ç¸„çœŒ",capital:"é‚£è¦‡å¸‚",file:"okinawa.png"}];

const allJapan=eastJapan.concat(westJapan);

let currentList=[], current, score=0, levelMode=1, totalQuestions=0;

function startGame(level){
levelMode=level;
score=0;

document.getElementById("menu").classList.add("hidden");
document.getElementById("finish").classList.add("hidden");
document.getElementById("game").classList.remove("hidden");

if(level==1||level==4){currentList=[...eastJapan];}
if(level==2||level==5){currentList=[...westJapan];}
if(level==3||level==6){currentList=[...allJapan];}

totalQuestions=currentList.length;
document.getElementById("prefAnswer").classList.toggle("hidden",level!=6);
nextQuestion();
}

function nextQuestion(){
if(currentList.length===0){finishGame();return;}
let index=Math.floor(Math.random()*currentList.length);
current=currentList.splice(index,1)[0];
document.getElementById("prefImage").src=current.file;
document.getElementById("prefName").textContent=(levelMode<=3)?current.name:"";
document.getElementById("capitalAnswer").value="";
document.getElementById("prefAnswer").value="";
document.getElementById("result").textContent="";
document.getElementById("result").className="";
document.getElementById("score").textContent=score;
document.getElementById("remaining").textContent=currentList.length;
}

function checkAnswer(){
let cap=document.getElementById("capitalAnswer").value.trim();
let pref=document.getElementById("prefAnswer").value.trim();
let correct=false;

if(levelMode==6){
if(cap===current.capital && pref===current.name){correct=true;}
}else{
if(cap===current.capital){correct=true;}
}

let result=document.getElementById("result");
let gameCard=document.getElementById("game");

if(correct){
score++;
result.textContent="æ­£è§£ï¼";
result.className="correct";
gameCard.classList.add("flash-correct");
}else{
result.textContent="ä¸æ­£è§£ æ­£è§£ï¼š"+current.name+" / "+current.capital;
result.className="wrong";
gameCard.classList.add("flash-wrong");
}

setTimeout(()=>{
gameCard.classList.remove("flash-correct","flash-wrong");
nextQuestion();
},800);
}

function finishGame(){
document.getElementById("game").classList.add("hidden");
document.getElementById("finish").classList.remove("hidden");

let percent=Math.round((score/totalQuestions)*100);
let rankText="";

if(percent===100){rankText="ğŸ‘‘ çœŸã®ãƒã‚¹ã‚¿ãƒ¼";}
else if(percent>=90){rankText="ğŸ† Sãƒ©ãƒ³ã‚¯";}
else if(percent>=70){rankText="Aãƒ©ãƒ³ã‚¯";}
else if(percent>=50){rankText="Bãƒ©ãƒ³ã‚¯";}
else{rankText="ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ï¼";}

document.getElementById("finalScore").textContent="ã‚¹ã‚³ã‚¢ï¼š"+score+" / "+totalQuestions+" ("+percent+"%)";
document.getElementById("rank").textContent=rankText;

saveBestScore(percent);
displayBest();
}

function getBestKey(){
return "best_capital_level_" + levelMode;
}

function saveBestScore(percent){
let key=getBestKey();
let best=localStorage.getItem(key)||0;
if(percent>best){
localStorage.setItem(key,percent);
}
}

function displayBest(){
let text="å„ãƒ¬ãƒ™ãƒ« ãƒ™ã‚¹ãƒˆã‚¹ã‚³ã‚¢\n";
for(let i=1;i<=6;i++){
let key="best_capital_level_"+i;
let best=localStorage.getItem(key);
if(best){
text+="Lv"+i+" : "+best+"%\n";
}
}
document.getElementById("bestDisplay").innerText=text;
updateCrown();
}

function updateCrown(){
for(let i=1;i<=6;i++){
let key="best_capital_level_"+i;
let best=localStorage.getItem(key);
let btn=document.getElementById("btn"+i);
btn.innerHTML=btn.innerText.replace(" ğŸ‘‘","");
if(best==100){
btn.innerHTML=btn.innerText+" ğŸ‘‘";
}
}
}

function backToMenu(){
document.getElementById("game").classList.add("hidden");
document.getElementById("finish").classList.add("hidden");
document.getElementById("menu").classList.remove("hidden");
displayBest();
}

function restartSameLevel(){
startGame(levelMode);
}

displayBest();

// PWA
if("serviceWorker" in navigator){
navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>